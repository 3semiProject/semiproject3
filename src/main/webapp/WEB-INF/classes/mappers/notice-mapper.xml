<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="noticeMapper">

    <resultMap id="resultNotice" type="Notice">
        <id property="noticeno" column="noticeno"/>
        <result property="noticetitle" column="noticetitle"/>
        <result property="noticedate" column="noticedate"/>
        <result property="noticewriter" column="noticewriter"/>
        <result property="noticecontent" column="noticecontent"/>
        <result property="original_filepath" column="original_filepath"/>
        <result property="rename_filepath" column="rename_filepath"/>
    </resultMap>

    <resultMap id="resultNoticeTop5" type="Notice">
        <id property="noticeno" column="noticeno"/>
        <result property="noticetitle" column="noticetitle"/>
        <result property="noticedate" column="noticedate"/>
    </resultMap>

    <resultMap id="resultSearchNotice" type="Notice">
        <id property="noticeno" column="noticeno"/>
        <result property="noticetitle" column="noticetitle"/>
        <result property="noticedate" column="noticedate"/>
        <result property="noticewriter" column="noticewriter"/>
        <result property="original_filepath" column="original_filepath"/>
    </resultMap>


    <select id="selectNewTop5" resultMap="resultNoticeTop5">
        <![CDATA[
        select *
        from (select ROWNUM rnum, NOTICENO, NOTICETITLE, NOTICEDATE
              from (select *
                    from NOTICE
                    order by NOTICEDATE desc, NOTICENO desc))
        where rnum <= 5
        ]]>
    </select>

    <select id="selectAll" resultMap="resultNotice">
        select *
        from NOTICE
        order by NOTICENO desc
    </select>


    <select id="selectNotice" parameterType="_int" resultMap="resultNotice">
        select *
        from NOTICE
        where NOTICENO = #{noticeno}

    </select>
    <select id="selectLast"></select>
    <insert id="insertNotice" parameterType="Notice">
        insert into notice (NOTICENO, NOTICETITLE, NOTICEWRITER, NOTICEDATE,
                            NOTICECONTENT, ORIGINAL_FILEPATH, RENAME_FILEPATH)
        values ((select max(NOTICENO) + 1 from NOTICE), #{noticetitle},
                #{noticewriter}, sysdate, #{noticecontent},
                #{original_filepath, jdbcType=VARCHAR},
                #{rename_filepath, jdbcType=VARCHAR})
    </insert>

    <update id="updateNotice" parameterType="Notice">
        update NOTICE
        set NOTICETITLE = #{noticetitle},
        NOTICECONTENT = #{noticecontent}
        <if test="original_filepath != null">
            ,ORIGINAL_FILEPATH = #{original_filepath}
            ,RENAME_FILEPATH = #{rename_filepath}
        </if>
        <if test="original_filepath == null">
            ,ORIGINAL_FILEPATH =null
            ,RENAME_FILEPATH = null
        </if>
        where noticeno = #{noticeno}
    </update>

    <delete id="deleteNotice" parameterType="_int">
        delete
        from NOTICE
        where NOTICENO =#{noticeno}
    </delete>

    <select id="selectSearchTitle" parameterType="string" resultMap="resultSearchNotice">
        select *
        from NOTICE
        where noticetitle like '%' || #{keyword} || '%'
        order by noticeno desc
    </select>

    <select id="selectSearchWriter" parameterType="string" resultMap="resultSearchNotice">
        select *
        from NOTICE
        where NOTICEWRITER like '%' || #{keyword} || '%'
        order by noticeno desc
    </select>

    <select id="selectSearchDate" parameterType="SearchDate" resultMap="resultSearchNotice">
        select *
        from NOTICE
        where noticedate between #{begin} - 1 and #{end} + 1
        order by noticeno desc
    </select>

</mapper>
